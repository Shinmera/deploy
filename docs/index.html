<!DOCTYPE html> <html lang="EN"> <head> <meta charset="utf-8"> <title>Deploy</title> <style>html body{margin:0 auto 0 auto;padding:20px;max-width:1024px;font-family:sans-serif;font-size:14pt;overflow-y:scroll;}html body a{text-decoration:none;}html body a[href]{color:#0055AA;}html body a[href]:hover{color:#0088EE;}html body pre{background:#FAFAFA;border:1px solid #DDDDDD;padding:0.75em;overflow-x:auto;}html body pre >code a[href]{color:#223388;}article.project h1{font-size:1.7em;}article.project h1,article.project h2,article.project h3,article.project h4,article.project h5,article.project h6{margin:0.2em 0 0.1em 0;text-indent:1em;}article.project >header{text-align:center;}article.project >header img.logo{display:block;margin:auto;max-height:170px;}article.project >header h1{display:inline-block;text-indent:0;font-size:2.5em;}article.project >header .version{vertical-align:bottom;}article.project >header .languages{margin-top:-0.5em;text-transform:capitalize;}article.project >header .description{margin:0;}article.project >header .pages{margin-top:0.5em;font-size:1.2em;text-transform:capitalize;}article.project >header .pages a{display:inline-block;padding:0 0.2em;}article.project >section{margin:1em 0 1em 0;}article.project >section img{max-width:100%;}article.project #index >ul{list-style:none;margin:0;padding:0;}article.project .row label{display:inline-block;min-width:8em;}article.project #system .row{display:flex;}article.project #system #dependencies{display:inline;margin:0;padding:0;}article.project #system #dependencies li{display:inline;padding:0 0.2em;}article.project #system #author label{vertical-align:top;}article.project #system #author ul{display:inline-block;margin:0;padding:0;list-style:none;}article.project #toc nav>*{margin-left:1em;display:block;}article.definition{margin:1em 0 0 0;}article.definition >header h1,article.definition >header h2,article.definition >header h3,article.definition >header h4,article.definition >header h5,article.definition >header h6{text-indent:0;display:inline-block;}article.definition >header ul{display:inline-block;list-style:none;margin:0;padding:0;}article.definition >header ul li{display:inline-block;padding:0 0.2em 0 0;}article.definition >header .visibility{display:none;}article.definition >header .visibility,article.definition >header .type{text-transform:lowercase;}article.definition >header .source-link{visibility:hidden;float:right;}article.definition >header .source-link:after{visibility:visible;content:"[SRC]";}article.definition .docstring{margin:0 0 0 1em;}article.definition .docstring pre{font-size:0.8em;white-space:pre-wrap;}.definition.package >header ul.nicknames{display:inline-block;list-style:none;margin:0;padding:0 0 0 1em;}.definition.package >header ul.nicknames li{display:inline;}.definition.package >header ul.nicknames:before{content:"(";}.definition.package >header ul.nicknames:after{content:")";}.definition.package ul.definitions{margin:0;list-style:none;padding:0 0 0 0.5em;}.definition.callable >header .name:before,.definition.type >header .name:before{content:"(";font-weight:normal;}.definition.callable >header .arguments:after,.definition.type >header .arguments:after{content:")";}.definition.callable >header .arguments .arguments:before,.definition.type >header .arguments .arguments:before{content:"(";}.definition.callable >header .arguments .argument,.definition.type >header .arguments .argument{padding:0;}.definition.callable >header .arguments .argument.lambda-list-keyword,.definition.type >header .arguments .argument.lambda-list-keyword{color:#991155;}.definition li>mark{background:none;border-left:0.3em solid #0088EE;padding-left:0.3em;display:block;}@media (min-width: 1300px){html body{padding-left:16em;}article.project #toc{margin:0;position:fixed;left:0;top:0;bottom:0;width:15em;overflow-y:auto;background:#F0F0F0;border-right:1px solid #A0A0A0;}}</style> </head> <body> <article class="project"> <header>   <h1>deploy</h1>   <span class="version">2.0.0</span>    <p class="description">Tools to aid in the deployment of a fully standalone application.</p>   </header> <section id="toc"> <h2>Table of Contents</h2> <nav> <a href="#project">Top</a>  <a href="#documentation">Documentation</a> <nav> <a href="#about_deploy">About Deploy</a>  <a href="#how_to">How To</a>  <a href="#customising_foreign_libraries">Customising Foreign Libraries</a>  <a href="#extending_deployment_and_boot_behaviour">Extending Deployment and Boot Behaviour</a>  <a href="#deploying_to_an_os_x_app_bundle">Deploying to an OS X App Bundle</a>  <a href="#debugging_a_deployed_executable">Debugging a Deployed Executable</a>  <a href="#support">Support</a> </nav>  <a href="#system">System</a>  </nav> </section>  <section id="documentation"><h2 id="about_deploy">About Deploy</h2> <p>This is a system to help you easily and quickly deploy standalone common lisp applications as binaries. Specifically it is geared towards applications with foreign library dependencies that run some kind of GUI.</p> <h2 id="how_to">How To</h2> <p>In order to make use of Deploy, you'll have to change the ASDF system definition of your project to contain the following properties:</p> <pre><code>:defsystem-depends-on (:deploy)
:build-operation &quot;deploy-op&quot;
:build-pathname &quot;my-application-name&quot;
:entry-point &quot;my-package:my-start-function&quot;
</code></pre> <p>Once you have updated your system appropriately, all you need to do is start a fresh instance of your implementation from a terminal and run the following function:</p> <pre><code>(asdf:make :my-system)
</code></pre> <p>This will build your system, gather the necessary information, and deploy a standalone <code>bin</code> folder within your project's root directory. You can then ship this folder to your users.</p> <h2 id="customising_foreign_libraries">Customising Foreign Libraries</h2> <p>Sometimes you might want to designate a specific library for deployment, rather than the one used during development. If this is the case, you have to help Deploy out a little by defining extra information about the library with <code>define-library</code>. If the foreign library is in the source tree of a lisp library, you can simply associate the CFFI library with the system that provides it, and Deploy will find it automatically:</p> <pre><code><a href="http://l1sp.org/cl/change-class" class="xref">(</a>deploy:define-library cffi-library-symbol
  :system :system-name-that-defines-the-library)
</code></pre> <p>For example, the <a href="https://github.com/Shirakumo/cl-mpg123">cl-mpg123</a> system provides a single library, which we would annotate like this:</p> <pre><code><a href="http://l1sp.org/cl/change-class" class="xref">(</a>deploy:define-library cl-mpg123-cffi:libmpg123
  :system :cl-mpg123)
</code></pre> <p>If the file is not contained in the directory of the system that provides it, you can also designate specific source directories to scan:</p> <pre><code><a href="http://l1sp.org/cl/change-class" class="xref">(</a>deploy:define-library cffi-library-symbol
  :sources '(&quot;/some/path/where/the/library/is/stored/&quot;)) 
</code></pre> <p>Finally, you can also specify the path directly if you want Deploy to choose a particular file, rather than trying to find one on its own:</p> <pre><code><a href="http://l1sp.org/cl/change-class" class="xref">(</a>deploy:define-library cffi-library-symbol
  :path &quot;/some/path/to/the/file.so&quot;)
</code></pre> <p>Generally though these extra associations should not be necessary as Deploy will simply take the path that CFFI has already figured out to find the library.</p> <p>Sometimes it might not be desired to deploy all the libraries, or reload them all upon boot. You can change this behaviour with <code>define-library</code>'s <code>:dont-deploy</code> and <code>:dont-open</code> properties respectively.</p> <h2 id="extending_deployment_and_boot_behaviour">Extending Deployment and Boot Behaviour</h2> <p>Deploy also offers a hooks system with which you can easily extend the steps performed during deployment and during the boot process of the generated executable. With the <code>define-hook</code> macro you can add functions that are executed during various points of the process. Specifically, the following types are available:</p> <ul> <li><code>:deploy</code> These functions are responsible for copying files into the deployment target directory.</li> <li><code>:build</code> These functions should prepare the system for the dump to binary. Specifically you might want to shut down existing threads, close file handles, remove unneeded baggage, and remove potentially sensitive information about your system.</li> <li><code>:boot</code> These functions are run right before the primary entry point is executed. Thus they are responsible for preparing the runtime to continue by restarting threads, re-opening files, and so forth.</li> <li><code>:quit</code> These functions are run right before the executable exits completely. They offer a last-minute opportunity to dump some information about the system, or to clean up vital resources.</li> </ul> <p>If you would simply like to include a data directory to bundle with the rest, use <code>define-resource-directory</code>. After boot, all of the resource files will be in the directory returned by <code>data-directory</code>.</p> <h2 id="deploying_to_an_os_x_app_bundle">Deploying to an OS X App Bundle</h2> <p>If you would like a nicely bundled <code>.app</code> for OS X, you can simply change the <code>build-operation</code> in your ASDF system file to <code>osx-app-deploy-op</code>. If you would like to customise the <code>Info.plist</code> file that is generated for the app, you can change <code>*info-plist-template*</code> to point to a file that contains what you want.</p> <h2 id="debugging_a_deployed_executable">Debugging a Deployed Executable</h2> <p>If you're having trouble with an application that's already deployed, there's a few things you can do to debug it by setting environment variables. The following are recognised by Deploy:</p> <ul> <li><code>DEPLOY_DEBUG_BOOT</code> if set to a non-empty value, on error the debugger is invoked rather than just exiting the application.</li> <li><code>DEPLOY_REDIRECT_OUTPUT</code> if set to a file path, the output of all streams is redirected to this file.</li> </ul> <p>Particularly on Windows and OS X debugging can be an issue, as a GUI application will not get a standard output to write to. In that case, the above redirect might help. Alternatively, on Windows, you can build your binary with the feature flag <code>:deploy-console</code> present, which will force it to deploy as a console application.</p> <h2 id="support">Support</h2> <p>If you'd like to support the continued development of Deploy, please consider becoming a backer on Patreon:</p> <p><a href="https://patreon.com/shinmera"> <img alt="Patreon" src="https://filebox.tymoon.eu//file/TWpjeU9RPT0="> </a></p> </section>    <section id="system"> <h2>System Information</h2>  <div class="row"> <label for="version">Version:</label> <a id="version">2.0.0</a> </div>   <div class="row"> <label for="dependencies">Dependencies:</label> <ul id="dependencies"><li><a class="external">cffi</a></li><li><a class="external">sha3</a></li><li><a class="external" href="https://Shinmera.github.io/documentation-utils/">documentation-utils</a></li><li><a class="external">trivial-features</a></li></ul> </div>   <div class="row" id="author"> <label for="author">Author:</label> <a href="mailto:shinmera@tymoon.eu">Yukari Hafner</a> </div>   <div class="row"> <label for="license">License:</label> <a id="license" href="https://github.com/Shinmera/deploy/blob/5684378d36f88b552b7dc8fae3bbf15c05af91ac/LICENSE">zlib</a> </div>   <div class="row"> <label for="homepage">Homepage:</label> <a id="homepage" href="https://Shinmera.github.io/deploy/">https://Shinmera.github.io/deploy/</a> </div>   <div class="row"> <label for="bug-tracker">Bug Tracker:</label> <a id="bug-tracker" href="https://github.com/Shinmera/deploy/issues">https://github.com/Shinmera/deploy/issues</a> </div>   <div class="row"> <label for="sources">Sources:</label> <a id="sources" href="https://github.com/Shinmera/deploy.git">https://github.com/Shinmera/deploy.git</a> </div>  </section>    </article> <script>window.addEventListener("DOMContentLoaded", function(){
    var unmarkElement = function(el){
        if(el.tagName === "mark" || el.tagName === "MARK"){
            [].forEach.call(el.childNodes, function(child){
                el.parentNode.insertBefore(child, el);
            });
            el.parentNode.removeChild(el);
        }else if(el.parentNode.tagName === "mark"){
            return unmarkElement(el.parentNode);
        }
        return null;
    }

    var unmarkAll = function(root){
        root = root || document;
        [].forEach.call(root.querySelectorAll("mark"), unmarkElement);
    }
    
    var markElement = function(el){
        if(el.parentNode.tagName === "mark" || el.parentNode.tagName === "MARK"){
            return el.parentNode;
        } else {
            unmarkAll();
            var marked = document.createElement("mark");
            el.parentNode.insertBefore(marked, el);
            marked.appendChild(el);
            return marked;
        }
    }

    var markFragmented = function(){
        if(window.location.hash){
            var el = document.getElementById(decodeURIComponent(window.location.hash.substr(1)));
            if(el) markElement(el);
        }
    }

    var registerXrefLink = function(link){
        var el = document.getElementById(decodeURIComponent(link.getAttribute("href").substr(1)));
        if(el){
            link.addEventListener("click", function(){
                markElement(el);
            });
        }
    }

    var registerXrefLinks = function(root){
        root = root || document;
        [].forEach.call(root.querySelectorAll("a.xref"), registerXrefLink);
    }

    markFragmented();
    registerXrefLinks();
}); </script> </body> </html> 